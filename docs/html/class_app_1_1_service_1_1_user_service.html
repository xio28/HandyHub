<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HandyHub: UserService Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo-light.png"/></td>
  <td id="projectalign">
   <div id="projectname">HandyHub<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Instantly hire professionals for home services like electricians, carpenters, locksmiths, etc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_app.html">App</a></li><li class="navelem"><b>Service</b></li><li class="navelem"><a class="el" href="class_app_1_1_service_1_1_user_service.html">UserService</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle"><div class="title">UserService Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a43a03f60fce84cb878915cf4f4c62588"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a43a03f60fce84cb878915cf4f4c62588">__construct</a> (DocumentManager $documentManager, ValidatorInterface $validator, LoggerInterface $logger, <a class="el" href="class_app_1_1_service_1_1_email_service.html">EmailService</a> $emailService, UrlGeneratorInterface $router, UserPasswordHasherInterface $passwordHasher, <a class="el" href="class_app_1_1_repository_1_1_user_repository.html">UserRepository</a> $userRepository, <a class="el" href="class_app_1_1_repository_1_1_category_repository.html">CategoryRepository</a> $categoryRepository, string $publicDirectory)</td></tr>
<tr class="separator:a43a03f60fce84cb878915cf4f4c62588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa12b5d9a285c230b55216e1c30bf64ac"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#aa12b5d9a285c230b55216e1c30bf64ac">registerClient</a> (Request $request)</td></tr>
<tr class="separator:aa12b5d9a285c230b55216e1c30bf64ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8fb97b374f4442b5fba530c36a3c226"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#ae8fb97b374f4442b5fba530c36a3c226">updateClient</a> (Request $request, int $id)</td></tr>
<tr class="separator:ae8fb97b374f4442b5fba530c36a3c226"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81f67b6b1f2fe3b65191359f78e60748"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a81f67b6b1f2fe3b65191359f78e60748">registerSpecialist</a> (Request $request)</td></tr>
<tr class="separator:a81f67b6b1f2fe3b65191359f78e60748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3797181035bb7da24fd95c6736fcece6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a3797181035bb7da24fd95c6736fcece6">updateSpecialist</a> (Request $request, int $id)</td></tr>
<tr class="separator:a3797181035bb7da24fd95c6736fcece6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47c4a3c6d1cded85654840e19e16fbc5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a47c4a3c6d1cded85654840e19e16fbc5">registerAdmin</a> (Request $request)</td></tr>
<tr class="separator:a47c4a3c6d1cded85654840e19e16fbc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3062c8fd529939a6098cbf8ba3560e20"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a3062c8fd529939a6098cbf8ba3560e20">resendEmail</a> (int $id)</td></tr>
<tr class="separator:a3062c8fd529939a6098cbf8ba3560e20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1496060b606c43911c2f6bd21dbb8f37"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a1496060b606c43911c2f6bd21dbb8f37">deleteUserById</a> (int $id)</td></tr>
<tr class="separator:a1496060b606c43911c2f6bd21dbb8f37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a2cf8b40c95bc8123ff10f8bbe27acf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a1a2cf8b40c95bc8123ff10f8bbe27acf">checkPassword</a> (string $password, <a class="el" href="class_app_1_1_document_1_1_users_document.html">UsersDocument</a> $user)</td></tr>
<tr class="separator:a1a2cf8b40c95bc8123ff10f8bbe27acf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3621d9ddae0ebfb1516d9c597f3aff68"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_user_service.html#a3621d9ddae0ebfb1516d9c597f3aff68">checkEmail</a> (string $email)</td></tr>
<tr class="separator:a3621d9ddae0ebfb1516d9c597f3aff68"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a43a03f60fce84cb878915cf4f4c62588" name="a43a03f60fce84cb878915cf4f4c62588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43a03f60fce84cb878915cf4f4c62588">&#9670;&#160;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__construct </td>
          <td>(</td>
          <td class="paramtype">DocumentManager&#160;</td>
          <td class="paramname"><em>$documentManager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ValidatorInterface&#160;</td>
          <td class="paramname"><em>$validator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LoggerInterface&#160;</td>
          <td class="paramname"><em>$logger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_app_1_1_service_1_1_email_service.html">EmailService</a>&#160;</td>
          <td class="paramname"><em>$emailService</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UrlGeneratorInterface&#160;</td>
          <td class="paramname"><em>$router</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UserPasswordHasherInterface&#160;</td>
          <td class="paramname"><em>$passwordHasher</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_app_1_1_repository_1_1_user_repository.html">UserRepository</a>&#160;</td>
          <td class="paramname"><em>$userRepository</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_app_1_1_repository_1_1_category_repository.html">CategoryRepository</a>&#160;</td>
          <td class="paramname"><em>$categoryRepository</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$publicDirectory</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   47</span>      {</div>
<div class="line"><span class="lineno">   48</span>        $this-&gt;documentManager = $documentManager;</div>
<div class="line"><span class="lineno">   49</span>        $this-&gt;validator = $validator;</div>
<div class="line"><span class="lineno">   50</span>        $this-&gt;logger = $logger;</div>
<div class="line"><span class="lineno">   51</span>        $this-&gt;emailService = $emailService;</div>
<div class="line"><span class="lineno">   52</span>        $this-&gt;router = $router;</div>
<div class="line"><span class="lineno">   53</span>        $this-&gt;passwordHasher = $passwordHasher;</div>
<div class="line"><span class="lineno">   54</span>        $this-&gt;userRepository = $userRepository;</div>
<div class="line"><span class="lineno">   55</span>        $this-&gt;categoryRepository = $categoryRepository;</div>
<div class="line"><span class="lineno">   56</span>        $this-&gt;publicDirectory = $publicDirectory;</div>
<div class="line"><span class="lineno">   57</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a3621d9ddae0ebfb1516d9c597f3aff68" name="a3621d9ddae0ebfb1516d9c597f3aff68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3621d9ddae0ebfb1516d9c597f3aff68">&#9670;&#160;</a></span>checkEmail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">checkEmail </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$email</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks if an email exists in the user repository.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>The email to be checked. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool Returns true if the email exists in the user repository, false otherwise. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  446</span>                                             : <span class="keywordtype">bool</span></div>
<div class="line"><span class="lineno">  447</span>    {</div>
<div class="line"><span class="lineno">  448</span>        $emailExists = $this-&gt;userRepository-&gt;findUserByEmail($email);</div>
<div class="line"><span class="lineno">  449</span>        <span class="keywordflow">return</span> $emailExists instanceof <a class="code hl_class" href="class_app_1_1_document_1_1_users_document.html">UsersDocument</a>;</div>
<div class="line"><span class="lineno">  450</span>    }</div>
<div class="ttc" id="aclass_app_1_1_document_1_1_users_document_html"><div class="ttname"><a href="class_app_1_1_document_1_1_users_document.html">App\Document\UsersDocument</a></div><div class="ttdef"><b>Definition:</b> UsersDocument.php:18</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1a2cf8b40c95bc8123ff10f8bbe27acf" name="a1a2cf8b40c95bc8123ff10f8bbe27acf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a2cf8b40c95bc8123ff10f8bbe27acf">&#9670;&#160;</a></span>checkPassword()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">checkPassword </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_app_1_1_document_1_1_users_document.html">UsersDocument</a>&#160;</td>
          <td class="paramname"><em>$user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if a given password matches the hashed password of a user.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$password</td><td>The password to be checked. </td></tr>
    <tr><td class="paramtype">UsersDocument</td><td class="paramname">$user</td><td>The user document. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool True if the password matches, false otherwise. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  435</span>                                                                        : <span class="keywordtype">bool</span></div>
<div class="line"><span class="lineno">  436</span>    {</div>
<div class="line"><span class="lineno">  437</span>        <span class="keywordflow">return</span> $this-&gt;passwordHasher-&gt;isPasswordValid($user, $password);</div>
<div class="line"><span class="lineno">  438</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1496060b606c43911c2f6bd21dbb8f37" name="a1496060b606c43911c2f6bd21dbb8f37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1496060b606c43911c2f6bd21dbb8f37">&#9670;&#160;</a></span>deleteUserById()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">deleteUserById </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Delete a user by their ID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>The ID of the user to be deleted. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  406</span>                                           : <span class="keywordtype">void</span></div>
<div class="line"><span class="lineno">  407</span>    {</div>
<div class="line"><span class="lineno">  408</span>        $user = $this-&gt;userRepository-&gt;findUserById($id);</div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>        <span class="keywordflow">if</span> ($user) {</div>
<div class="line"><span class="lineno">  411</span>            $this-&gt;documentManager-&gt;remove($user);</div>
<div class="line"><span class="lineno">  412</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  413</span>        }</div>
<div class="line"><span class="lineno">  414</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a47c4a3c6d1cded85654840e19e16fbc5" name="a47c4a3c6d1cded85654840e19e16fbc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47c4a3c6d1cded85654840e19e16fbc5">&#9670;&#160;</a></span>registerAdmin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">registerAdmin </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a new admin.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>The HTTP request object with the admin data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool|Response Returns true if the admin is registered successfully, otherwise returns a HTTP response with an error message. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Exception </p>
<div class="fragment"><div class="line"><span class="lineno">  346</span>    {</div>
<div class="line"><span class="lineno">  347</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  348</span>            $user = <span class="keyword">new</span> <a class="code hl_class" href="class_app_1_1_document_1_1_users_document.html">UsersDocument</a>();</div>
<div class="line"><span class="lineno">  349</span> </div>
<div class="line"><span class="lineno">  350</span>            <span class="keywordflow">if</span> ($this-&gt;<a class="code hl_function" href="class_app_1_1_service_1_1_user_service.html#a3621d9ddae0ebfb1516d9c597f3aff68">checkEmail</a>($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>))) {</div>
<div class="line"><span class="lineno">  351</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;Email is in use.&#39;</span>);</div>
<div class="line"><span class="lineno">  352</span>            }</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>            $user-&gt;setEmail($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>));</div>
<div class="line"><span class="lineno">  355</span>            $user-&gt;setPassword($this-&gt;hashPassword($request-&gt;get(<span class="stringliteral">&#39;password&#39;</span>), $user));</div>
<div class="line"><span class="lineno">  356</span>            $user-&gt;setName($request-&gt;get(<span class="stringliteral">&#39;name&#39;</span>));</div>
<div class="line"><span class="lineno">  357</span>            $user-&gt;setSurname($request-&gt;get(<span class="stringliteral">&#39;surname&#39;</span>));</div>
<div class="line"><span class="lineno">  358</span>            $user-&gt;setRoles([<a class="code hl_variable" href="class_app_1_1_constants_1_1_roles_constants.html#a8994a032000d46908c203b767f3adb43">RolesConstants::ROLE_ADMIN</a>]);</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">  361</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  362</span> </div>
<div class="line"><span class="lineno">  363</span>            $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;Admin &#39;</span> . $user-&gt;getId() . <span class="stringliteral">&#39; registered successfully&#39;</span>);</div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  366</span> </div>
<div class="line"><span class="lineno">  367</span>        } <span class="keywordflow">catch</span>(Exception $e) {</div>
<div class="line"><span class="lineno">  368</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Admin register failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  369</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Ha habido un error al registrar el administrador. Por favor, inténtalo de nuevo.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  370</span>        }</div>
<div class="line"><span class="lineno">  371</span>    }</div>
<div class="ttc" id="aclass_app_1_1_constants_1_1_roles_constants_html_a8994a032000d46908c203b767f3adb43"><div class="ttname"><a href="class_app_1_1_constants_1_1_roles_constants.html#a8994a032000d46908c203b767f3adb43">App\Constants\RolesConstants\ROLE_ADMIN</a></div><div class="ttdeci">const ROLE_ADMIN</div><div class="ttdef"><b>Definition:</b> RolesConstants.php:24</div></div>
<div class="ttc" id="aclass_app_1_1_service_1_1_user_service_html_a3621d9ddae0ebfb1516d9c597f3aff68"><div class="ttname"><a href="class_app_1_1_service_1_1_user_service.html#a3621d9ddae0ebfb1516d9c597f3aff68">App\Service\UserService\checkEmail</a></div><div class="ttdeci">checkEmail(string $email)</div><div class="ttdef"><b>Definition:</b> UserService.php:446</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa12b5d9a285c230b55216e1c30bf64ac" name="aa12b5d9a285c230b55216e1c30bf64ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa12b5d9a285c230b55216e1c30bf64ac">&#9670;&#160;</a></span>registerClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">registerClient </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a new client.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>The HTTP request object with the client data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool|Response Returns true if the client is registered successfully, otherwise returns a HTTP response with an error message. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Exception </p>
<div class="fragment"><div class="line"><span class="lineno">   67</span>    {</div>
<div class="line"><span class="lineno">   68</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">   69</span>            $user = <span class="keyword">new</span> <a class="code hl_class" href="class_app_1_1_document_1_1_users_document.html">UsersDocument</a>();</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>            <span class="keywordflow">if</span> ($this-&gt;<a class="code hl_function" href="class_app_1_1_service_1_1_user_service.html#a3621d9ddae0ebfb1516d9c597f3aff68">checkEmail</a>($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>))) {</div>
<div class="line"><span class="lineno">   72</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;Email is in use.&#39;</span>);</div>
<div class="line"><span class="lineno">   73</span>            }</div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>            $user-&gt;setEmail($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>));</div>
<div class="line"><span class="lineno">   76</span>            $user-&gt;setPassword($this-&gt;hashPassword($request-&gt;get(<span class="stringliteral">&#39;password&#39;</span>), $user));</div>
<div class="line"><span class="lineno">   77</span>            $user-&gt;setName($request-&gt;get(<span class="stringliteral">&#39;name&#39;</span>));</div>
<div class="line"><span class="lineno">   78</span>            $user-&gt;setSurname($request-&gt;get(<span class="stringliteral">&#39;surname&#39;</span>));</div>
<div class="line"><span class="lineno">   79</span>            $user-&gt;setAddress($request-&gt;get(<span class="stringliteral">&#39;address&#39;</span>));</div>
<div class="line"><span class="lineno">   80</span>            $user-&gt;setTelephone($request-&gt;get(<span class="stringliteral">&#39;telephone&#39;</span>));</div>
<div class="line"><span class="lineno">   81</span>            $user-&gt;setRoles([<a class="code hl_variable" href="class_app_1_1_constants_1_1_roles_constants.html#a73df99ee41d9e364ebab2db6d01d182d">RolesConstants::ROLE_CLIENT</a>]);</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>            $creditCardInfo = [</div>
<div class="line"><span class="lineno">   84</span>                <span class="stringliteral">&#39;number&#39;</span> =&gt; $request-&gt;get(<span class="stringliteral">&#39;creditNumber&#39;</span>),</div>
<div class="line"><span class="lineno">   85</span>                <span class="stringliteral">&#39;name&#39;</span> =&gt; $request-&gt;get(<span class="stringliteral">&#39;creditName&#39;</span>),</div>
<div class="line"><span class="lineno">   86</span>                <span class="stringliteral">&#39;expiry&#39;</span> =&gt; $request-&gt;get(<span class="stringliteral">&#39;creditExpire&#39;</span>),</div>
<div class="line"><span class="lineno">   87</span>                <span class="stringliteral">&#39;cvv&#39;</span> =&gt; $request-&gt;get(<span class="stringliteral">&#39;creditCvv&#39;</span>),</div>
<div class="line"><span class="lineno">   88</span>            ];</div>
<div class="line"><span class="lineno">   89</span>            $user-&gt;setCreditCard($creditCardInfo);</div>
<div class="line"><span class="lineno">   90</span>            $user-&gt;setPolicy($request-&gt;get(<span class="stringliteral">&#39;privacy&#39;</span>));</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>            $user-&gt;setIsVerified($user-&gt;getIsVerified());</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">   95</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>            $image = $request-&gt;files-&gt;get(<span class="stringliteral">&#39;image&#39;</span>);</div>
<div class="line"><span class="lineno">   98</span>            $dir = $this-&gt;publicDirectory;</div>
<div class="line"><span class="lineno">   99</span>            $resourcesPath = <span class="stringliteral">&#39;/resources/images/users/&#39;</span>;</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>            <span class="keywordflow">if</span>($image) {</div>
<div class="line"><span class="lineno">  102</span>                $fileName = <span class="stringliteral">&#39;client_&#39;</span> . $user-&gt;getId() . <span class="charliteral">&#39;.&#39;</span> . $image-&gt;getClientOriginalExtension();</div>
<div class="line"><span class="lineno">  103</span>                $image-&gt;move($dir . $resourcesPath, $fileName);</div>
<div class="line"><span class="lineno">  104</span>                $user-&gt;setImage($resourcesPath . $fileName);</div>
<div class="line"><span class="lineno">  105</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  106</span>                $user-&gt;setImage($resourcesPath . <span class="stringliteral">&#39;commonPic.jpg&#39;</span>);</div>
<div class="line"><span class="lineno">  107</span>            }</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">  110</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>            $verificationLink = $this-&gt;router-&gt;generate(<span class="stringliteral">&#39;app_verify_email&#39;</span>, [<span class="stringliteral">&#39;id&#39;</span> =&gt; $user-&gt;getId()], UrlGeneratorInterface::ABSOLUTE_URL);</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>            $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;User &#39;</span>. $user-&gt;getId(). <span class="stringliteral">&#39; registered successfully&#39;</span>);</div>
<div class="line"><span class="lineno">  115</span>            $this-&gt;emailService-&gt;sendVerificationEmail($user-&gt;getEmail(), $verificationLink);</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  118</span>            </div>
<div class="line"><span class="lineno">  119</span>        } <span class="keywordflow">catch</span>(Exception $e) {</div>
<div class="line"><span class="lineno">  120</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;User register failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  121</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Ha habido un error al registrarte. Por favor, inténtalo de nuevo.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  122</span>        }</div>
<div class="line"><span class="lineno">  123</span>    }</div>
<div class="ttc" id="aclass_app_1_1_constants_1_1_roles_constants_html_a73df99ee41d9e364ebab2db6d01d182d"><div class="ttname"><a href="class_app_1_1_constants_1_1_roles_constants.html#a73df99ee41d9e364ebab2db6d01d182d">App\Constants\RolesConstants\ROLE_CLIENT</a></div><div class="ttdeci">const ROLE_CLIENT</div><div class="ttdef"><b>Definition:</b> RolesConstants.php:38</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81f67b6b1f2fe3b65191359f78e60748" name="a81f67b6b1f2fe3b65191359f78e60748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81f67b6b1f2fe3b65191359f78e60748">&#9670;&#160;</a></span>registerSpecialist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">registerSpecialist </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register a new specialist.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>The HTTP request object with the specialist data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool|Response Returns true if the specialist is registered successfully, otherwise returns a HTTP response with an error message. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Exception </p>
<div class="fragment"><div class="line"><span class="lineno">  207</span>    {</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  209</span>            $user = <span class="keyword">new</span> <a class="code hl_class" href="class_app_1_1_document_1_1_users_document.html">UsersDocument</a>();</div>
<div class="line"><span class="lineno">  210</span>    </div>
<div class="line"><span class="lineno">  211</span>            <span class="keywordflow">if</span> ($this-&gt;<a class="code hl_function" href="class_app_1_1_service_1_1_user_service.html#a3621d9ddae0ebfb1516d9c597f3aff68">checkEmail</a>($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>))) {</div>
<div class="line"><span class="lineno">  212</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;Email is in use.&#39;</span>);</div>
<div class="line"><span class="lineno">  213</span>            }</div>
<div class="line"><span class="lineno">  214</span>    </div>
<div class="line"><span class="lineno">  215</span>            $user-&gt;setEmail($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>));</div>
<div class="line"><span class="lineno">  216</span>            $user-&gt;setPassword($this-&gt;hashPassword($request-&gt;get(<span class="stringliteral">&#39;password&#39;</span>), $user));</div>
<div class="line"><span class="lineno">  217</span>            $user-&gt;setName($request-&gt;get(<span class="stringliteral">&#39;name&#39;</span>));</div>
<div class="line"><span class="lineno">  218</span>            $user-&gt;setSurname($request-&gt;get(<span class="stringliteral">&#39;surname&#39;</span>));</div>
<div class="line"><span class="lineno">  219</span>            $user-&gt;setTelephone($request-&gt;get(<span class="stringliteral">&#39;telephone&#39;</span>));</div>
<div class="line"><span class="lineno">  220</span>            $user-&gt;setRoles([<a class="code hl_variable" href="class_app_1_1_constants_1_1_roles_constants.html#a45042b04b4dfa22609bb651bc63ac75d">RolesConstants::ROLE_SPECIALIST</a>]);</div>
<div class="line"><span class="lineno">  221</span>            $user-&gt;setCurrentAccount($request-&gt;get(<span class="stringliteral">&#39;current_account&#39;</span>));</div>
<div class="line"><span class="lineno">  222</span>            $user-&gt;setPricePerHour($request-&gt;get(<span class="stringliteral">&#39;price_per_hour&#39;</span>));</div>
<div class="line"><span class="lineno">  223</span>            $user-&gt;setIsAvailable(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  224</span>    </div>
<div class="line"><span class="lineno">  225</span>            $categoryId = $request-&gt;get(<span class="stringliteral">&#39;category&#39;</span>);</div>
<div class="line"><span class="lineno">  226</span>    </div>
<div class="line"><span class="lineno">  227</span>            $category = $this-&gt;categoryRepository-&gt;findCategoryById($categoryId);</div>
<div class="line"><span class="lineno">  228</span>    </div>
<div class="line"><span class="lineno">  229</span>            <span class="keywordflow">if</span> ($category === <span class="keyword">null</span>) {</div>
<div class="line"><span class="lineno">  230</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;Invalid category ID.&#39;</span>);</div>
<div class="line"><span class="lineno">  231</span>            }</div>
<div class="line"><span class="lineno">  232</span>    </div>
<div class="line"><span class="lineno">  233</span>            $user-&gt;setCategory($category);</div>
<div class="line"><span class="lineno">  234</span>    </div>
<div class="line"><span class="lineno">  235</span>            $user-&gt;setPolicy($request-&gt;get(<span class="stringliteral">&#39;privacy&#39;</span>));</div>
<div class="line"><span class="lineno">  236</span>    </div>
<div class="line"><span class="lineno">  237</span>            $user-&gt;setIsVerified($user-&gt;getIsVerified());</div>
<div class="line"><span class="lineno">  238</span>    </div>
<div class="line"><span class="lineno">  239</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">  240</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  241</span>    </div>
<div class="line"><span class="lineno">  242</span>            $image = $request-&gt;files-&gt;get(<span class="stringliteral">&#39;image&#39;</span>);</div>
<div class="line"><span class="lineno">  243</span>            $dir = $this-&gt;publicDirectory;</div>
<div class="line"><span class="lineno">  244</span>            $resourcesPath = <span class="stringliteral">&#39;/resources/images/users/&#39;</span>;</div>
<div class="line"><span class="lineno">  245</span>    </div>
<div class="line"><span class="lineno">  246</span>            <span class="keywordflow">if</span> ($image) {</div>
<div class="line"><span class="lineno">  247</span>                $fileName = <span class="stringliteral">&#39;specialist_&#39;</span> . $user-&gt;getId() . <span class="charliteral">&#39;.&#39;</span> . $image-&gt;getClientOriginalExtension();</div>
<div class="line"><span class="lineno">  248</span>                $image-&gt;move($dir . $resourcesPath, $fileName);</div>
<div class="line"><span class="lineno">  249</span>                $user-&gt;setImage($resourcesPath . $fileName);</div>
<div class="line"><span class="lineno">  250</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  251</span>                $user-&gt;setImage($resourcesPath . <span class="stringliteral">&#39;commonPic.jpg&#39;</span>);</div>
<div class="line"><span class="lineno">  252</span>            }</div>
<div class="line"><span class="lineno">  253</span>    </div>
<div class="line"><span class="lineno">  254</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">  255</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  256</span>    </div>
<div class="line"><span class="lineno">  257</span>            $verificationLink = $this-&gt;router-&gt;generate(<span class="stringliteral">&#39;app_verify_email&#39;</span>, [<span class="stringliteral">&#39;id&#39;</span> =&gt; $user-&gt;getId()], UrlGeneratorInterface::ABSOLUTE_URL);</div>
<div class="line"><span class="lineno">  258</span>    </div>
<div class="line"><span class="lineno">  259</span>            $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;User &#39;</span> . $user-&gt;getId() . <span class="stringliteral">&#39; registered successfully&#39;</span>);</div>
<div class="line"><span class="lineno">  260</span>            $this-&gt;emailService-&gt;sendVerificationEmail($user-&gt;getEmail(), $verificationLink);</div>
<div class="line"><span class="lineno">  261</span>    </div>
<div class="line"><span class="lineno">  262</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  263</span>    </div>
<div class="line"><span class="lineno">  264</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  265</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;User register failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  266</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Ha habido un error al registrarte. Por favor, inténtalo de nuevo.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  267</span>        }</div>
<div class="line"><span class="lineno">  268</span>    }</div>
<div class="ttc" id="aclass_app_1_1_constants_1_1_roles_constants_html_a45042b04b4dfa22609bb651bc63ac75d"><div class="ttname"><a href="class_app_1_1_constants_1_1_roles_constants.html#a45042b04b4dfa22609bb651bc63ac75d">App\Constants\RolesConstants\ROLE_SPECIALIST</a></div><div class="ttdeci">const ROLE_SPECIALIST</div><div class="ttdef"><b>Definition:</b> RolesConstants.php:31</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3062c8fd529939a6098cbf8ba3560e20" name="a3062c8fd529939a6098cbf8ba3560e20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3062c8fd529939a6098cbf8ba3560e20">&#9670;&#160;</a></span>resendEmail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">resendEmail </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Resend a verification email to a user.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>The ID of the user. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Response Returns a HTTP response indicating the result of the operation. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  379</span>                                         {</div>
<div class="line"><span class="lineno">  380</span>        $user = $this-&gt;userRepository-&gt;findUserById($id);</div>
<div class="line"><span class="lineno">  381</span>    </div>
<div class="line"><span class="lineno">  382</span>        <span class="keywordflow">if</span> (!$user) {</div>
<div class="line"><span class="lineno">  383</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;User with ID &#39;</span> . $id . <span class="stringliteral">&#39; not found&#39;</span>);</div>
<div class="line"><span class="lineno">  384</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;User not found.&#39;</span>, Response::HTTP_NOT_FOUND);</div>
<div class="line"><span class="lineno">  385</span>        }</div>
<div class="line"><span class="lineno">  386</span>    </div>
<div class="line"><span class="lineno">  387</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  388</span>            $verificationLink = $this-&gt;router-&gt;generate(<span class="stringliteral">&#39;app_verify_email&#39;</span>, [<span class="stringliteral">&#39;id&#39;</span> =&gt; $id], UrlGeneratorInterface::ABSOLUTE_URL);</div>
<div class="line"><span class="lineno">  389</span>            </div>
<div class="line"><span class="lineno">  390</span>            $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;Resend verification email to User &#39;</span> . $user-&gt;getId());</div>
<div class="line"><span class="lineno">  391</span>    </div>
<div class="line"><span class="lineno">  392</span>            $this-&gt;emailService-&gt;sendVerificationEmail($user-&gt;getEmail(), $verificationLink);</div>
<div class="line"><span class="lineno">  393</span>            </div>
<div class="line"><span class="lineno">  394</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Verification email resent successfully.&#39;</span>, Response::HTTP_OK);</div>
<div class="line"><span class="lineno">  395</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  396</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Resent verification email failed: &#39;</span>. $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  397</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Error trying to resend the email.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  398</span>        }</div>
<div class="line"><span class="lineno">  399</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8fb97b374f4442b5fba530c36a3c226" name="ae8fb97b374f4442b5fba530c36a3c226"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8fb97b374f4442b5fba530c36a3c226">&#9670;&#160;</a></span>updateClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">updateClient </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update a client's data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>The HTTP request object with the updated client data. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>The ID of the client to be updated. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool|Response Returns true if the client data is updated successfully, otherwise returns a HTTP response with an error message. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Exception </p>
<div class="fragment"><div class="line"><span class="lineno">  134</span>    {</div>
<div class="line"><span class="lineno">  135</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  136</span>            $user = $this-&gt;documentManager-&gt;getRepository(UsersDocument::class)-&gt;find($id);</div>
<div class="line"><span class="lineno">  137</span>    </div>
<div class="line"><span class="lineno">  138</span>            <span class="keywordflow">if</span> (!$user) {</div>
<div class="line"><span class="lineno">  139</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;User not found.&#39;</span>);</div>
<div class="line"><span class="lineno">  140</span>            }</div>
<div class="line"><span class="lineno">  141</span>    </div>
<div class="line"><span class="lineno">  142</span>            <span class="keywordflow">if</span> ($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>) &amp;&amp; $this-&gt;checkEmail($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>), $id)) {</div>
<div class="line"><span class="lineno">  143</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;Email is already in use.&#39;</span>);</div>
<div class="line"><span class="lineno">  144</span>            }</div>
<div class="line"><span class="lineno">  145</span>    </div>
<div class="line"><span class="lineno">  146</span>            $fieldsToUpdate = [<span class="stringliteral">&#39;email&#39;</span>, <span class="stringliteral">&#39;password&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;surname&#39;</span>, <span class="stringliteral">&#39;address&#39;</span>, <span class="stringliteral">&#39;telephone&#39;</span>];</div>
<div class="line"><span class="lineno">  147</span>            $creditCardFields = [<span class="stringliteral">&#39;creditNumber&#39;</span>, <span class="stringliteral">&#39;creditName&#39;</span>, <span class="stringliteral">&#39;creditExpire&#39;</span>, <span class="stringliteral">&#39;creditCvv&#39;</span>];</div>
<div class="line"><span class="lineno">  148</span>    </div>
<div class="line"><span class="lineno">  149</span>            <span class="keywordflow">foreach</span> ($fieldsToUpdate as $field) {</div>
<div class="line"><span class="lineno">  150</span>                <span class="keywordflow">if</span> ($request-&gt;request-&gt;has($field) &amp;&amp; $request-&gt;get($field) !== <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  151</span>                    $value = $request-&gt;get($field);</div>
<div class="line"><span class="lineno">  152</span>                    $setterMethod = <span class="stringliteral">&#39;set&#39;</span> . ucfirst($field);</div>
<div class="line"><span class="lineno">  153</span>                    $user-&gt;$setterMethod($value);</div>
<div class="line"><span class="lineno">  154</span>                }</div>
<div class="line"><span class="lineno">  155</span>            }</div>
<div class="line"><span class="lineno">  156</span>            </div>
<div class="line"><span class="lineno">  157</span>            $creditCardInfo = [];</div>
<div class="line"><span class="lineno">  158</span>            <span class="keywordflow">foreach</span> ($creditCardFields as $field) {</div>
<div class="line"><span class="lineno">  159</span>                <span class="keywordflow">if</span> ($request-&gt;request-&gt;has($field) &amp;&amp; $request-&gt;get($field) !== <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  160</span>                    $value = $request-&gt;get($field);</div>
<div class="line"><span class="lineno">  161</span>                    $creditCardInfo[$field] = $value;</div>
<div class="line"><span class="lineno">  162</span>                }</div>
<div class="line"><span class="lineno">  163</span>            }</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>            <span class="keywordflow">if</span> (!empty($creditCardInfo)) {</div>
<div class="line"><span class="lineno">  166</span>                $user-&gt;setCreditCard($creditCardInfo);</div>
<div class="line"><span class="lineno">  167</span>            }</div>
<div class="line"><span class="lineno">  168</span>    </div>
<div class="line"><span class="lineno">  169</span>            $image = $request-&gt;files-&gt;get(<span class="stringliteral">&#39;image&#39;</span>);</div>
<div class="line"><span class="lineno">  170</span>            $dir = $this-&gt;publicDirectory;</div>
<div class="line"><span class="lineno">  171</span>            $resourcesPath = <span class="stringliteral">&#39;/resources/images/users/&#39;</span>;</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>            <span class="keywordflow">if</span> ($image) {</div>
<div class="line"><span class="lineno">  174</span>                $currentImageName = $user-&gt;getImage();</div>
<div class="line"><span class="lineno">  175</span>                $currentImageFullPath = $dir . $currentImageName;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>                <span class="keywordflow">if</span> (file_exists($currentImageFullPath)) {</div>
<div class="line"><span class="lineno">  178</span>                    unlink($currentImageFullPath);</div>
<div class="line"><span class="lineno">  179</span>                }</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>                $fileName = <span class="stringliteral">&#39;client_&#39;</span> . $user-&gt;getId() . <span class="charliteral">&#39;.&#39;</span> . $image-&gt;getClientOriginalExtension();</div>
<div class="line"><span class="lineno">  182</span>                $image-&gt;move($dir . $resourcesPath, $fileName);</div>
<div class="line"><span class="lineno">  183</span>                $user-&gt;setImage($resourcesPath . $fileName);</div>
<div class="line"><span class="lineno">  184</span>            }</div>
<div class="line"><span class="lineno">  185</span>    </div>
<div class="line"><span class="lineno">  186</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">  187</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  188</span>    </div>
<div class="line"><span class="lineno">  189</span>            $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;User &#39;</span> . $user-&gt;getId() . <span class="stringliteral">&#39; updated successfully&#39;</span>);</div>
<div class="line"><span class="lineno">  190</span>    </div>
<div class="line"><span class="lineno">  191</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  192</span>    </div>
<div class="line"><span class="lineno">  193</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  194</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;User update failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  195</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Ha habido un error al actualizar el usuario. Por favor, inténtalo de nuevo.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  196</span>        }</div>
<div class="line"><span class="lineno">  197</span>    }    </div>
</div><!-- fragment -->
</div>
</div>
<a id="a3797181035bb7da24fd95c6736fcece6" name="a3797181035bb7da24fd95c6736fcece6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3797181035bb7da24fd95c6736fcece6">&#9670;&#160;</a></span>updateSpecialist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">updateSpecialist </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>$id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Update a specialist's data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>The HTTP request object with the updated specialist data. </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>The ID of the specialist to be updated. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool|Response Returns true if the specialist data is updated successfully, otherwise returns a HTTP response with an error message. </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"></td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Exception </p>
<div class="fragment"><div class="line"><span class="lineno">  279</span>    {</div>
<div class="line"><span class="lineno">  280</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  281</span>            $user = $this-&gt;documentManager-&gt;getRepository(UsersDocument::class)-&gt;find($id);</div>
<div class="line"><span class="lineno">  282</span>    </div>
<div class="line"><span class="lineno">  283</span>            <span class="keywordflow">if</span> (!$user) {</div>
<div class="line"><span class="lineno">  284</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;User not found.&#39;</span>);</div>
<div class="line"><span class="lineno">  285</span>            }</div>
<div class="line"><span class="lineno">  286</span>    </div>
<div class="line"><span class="lineno">  287</span>            <span class="keywordflow">if</span> ($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>) &amp;&amp; $this-&gt;checkEmail($request-&gt;get(<span class="stringliteral">&#39;email&#39;</span>), $id)) {</div>
<div class="line"><span class="lineno">  288</span>                <span class="keywordflow">throw</span> new \Exception(<span class="stringliteral">&#39;Email is already in use.&#39;</span>);</div>
<div class="line"><span class="lineno">  289</span>            }</div>
<div class="line"><span class="lineno">  290</span>    </div>
<div class="line"><span class="lineno">  291</span>            $fieldsToUpdate = [<span class="stringliteral">&#39;email&#39;</span>, <span class="stringliteral">&#39;password&#39;</span>, <span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;surname&#39;</span>, <span class="stringliteral">&#39;telephone&#39;</span>];</div>
<div class="line"><span class="lineno">  292</span>            <span class="keywordflow">foreach</span> ($fieldsToUpdate as $field) {</div>
<div class="line"><span class="lineno">  293</span>                <span class="keywordflow">if</span> ($request-&gt;request-&gt;has($field) &amp;&amp; $request-&gt;get($field) !== <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  294</span>                    $value = $request-&gt;get($field);</div>
<div class="line"><span class="lineno">  295</span>                    $setterMethod = <span class="stringliteral">&#39;set&#39;</span> . ucfirst($field);</div>
<div class="line"><span class="lineno">  296</span>                    $user-&gt;$setterMethod($value);</div>
<div class="line"><span class="lineno">  297</span>                }</div>
<div class="line"><span class="lineno">  298</span>            }</div>
<div class="line"><span class="lineno">  299</span>    </div>
<div class="line"><span class="lineno">  300</span>            <span class="keywordflow">if</span> ($request-&gt;request-&gt;has(<span class="stringliteral">&#39;current_account&#39;</span>) &amp;&amp; $request-&gt;get(<span class="stringliteral">&#39;current_account&#39;</span>) !== <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  301</span>                $user-&gt;setCurrentAccount($request-&gt;get(<span class="stringliteral">&#39;current_account&#39;</span>));</div>
<div class="line"><span class="lineno">  302</span>            }</div>
<div class="line"><span class="lineno">  303</span>    </div>
<div class="line"><span class="lineno">  304</span>            <span class="keywordflow">if</span> ($request-&gt;request-&gt;has(<span class="stringliteral">&#39;price_per_hour&#39;</span>) &amp;&amp; $request-&gt;get(<span class="stringliteral">&#39;price_per_hour&#39;</span>) !== <span class="stringliteral">&#39;&#39;</span>) {</div>
<div class="line"><span class="lineno">  305</span>                $user-&gt;setPricePerHour($request-&gt;get(<span class="stringliteral">&#39;price_per_hour&#39;</span>));</div>
<div class="line"><span class="lineno">  306</span>            }</div>
<div class="line"><span class="lineno">  307</span>    </div>
<div class="line"><span class="lineno">  308</span>            $image = $request-&gt;files-&gt;get(<span class="stringliteral">&#39;image&#39;</span>);</div>
<div class="line"><span class="lineno">  309</span>            $dir = $this-&gt;publicDirectory;</div>
<div class="line"><span class="lineno">  310</span>            $resourcesPath = <span class="stringliteral">&#39;/resources/images/users/&#39;</span>;</div>
<div class="line"><span class="lineno">  311</span>    </div>
<div class="line"><span class="lineno">  312</span>            <span class="keywordflow">if</span> ($image) {</div>
<div class="line"><span class="lineno">  313</span>                $currentImageName = $user-&gt;getImage();</div>
<div class="line"><span class="lineno">  314</span>                $currentImageFullPath = $dir . $currentImageName;</div>
<div class="line"><span class="lineno">  315</span>    </div>
<div class="line"><span class="lineno">  316</span>                <span class="keywordflow">if</span> (file_exists($currentImageFullPath)) {</div>
<div class="line"><span class="lineno">  317</span>                    unlink($currentImageFullPath);</div>
<div class="line"><span class="lineno">  318</span>                }</div>
<div class="line"><span class="lineno">  319</span>    </div>
<div class="line"><span class="lineno">  320</span>                $fileName = <span class="stringliteral">&#39;specialist_&#39;</span> . $user-&gt;getId() . <span class="charliteral">&#39;.&#39;</span> . $image-&gt;getClientOriginalExtension();</div>
<div class="line"><span class="lineno">  321</span>                $image-&gt;move($dir . $resourcesPath, $fileName);</div>
<div class="line"><span class="lineno">  322</span>                $user-&gt;setImage($resourcesPath . $fileName);</div>
<div class="line"><span class="lineno">  323</span>            }</div>
<div class="line"><span class="lineno">  324</span>    </div>
<div class="line"><span class="lineno">  325</span>            $this-&gt;documentManager-&gt;persist($user);</div>
<div class="line"><span class="lineno">  326</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  327</span>    </div>
<div class="line"><span class="lineno">  328</span>            $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;User &#39;</span> . $user-&gt;getId() . <span class="stringliteral">&#39; updated successfully&#39;</span>);</div>
<div class="line"><span class="lineno">  329</span>    </div>
<div class="line"><span class="lineno">  330</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  331</span>            </div>
<div class="line"><span class="lineno">  332</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  333</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;User update failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  334</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Ha habido un error al actualizar el usuario. Por favor, inténtalo de nuevo.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  335</span>        }</div>
<div class="line"><span class="lineno">  336</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/xampp/htdocs/HandyHub/src/Service/UserService.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
