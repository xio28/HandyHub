<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HandyHub: ContractService Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo-light.png"/></td>
  <td id="projectalign">
   <div id="projectname">HandyHub<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Instantly hire professionals for home services like electricians, carpenters, locksmiths, etc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_app.html">App</a></li><li class="navelem"><b>Service</b></li><li class="navelem"><a class="el" href="class_app_1_1_service_1_1_contract_service.html">ContractService</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle"><div class="title">ContractService Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2130357ddfd30f07fae57426520c82cc"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_contract_service.html#a2130357ddfd30f07fae57426520c82cc">__construct</a> (<a class="el" href="class_app_1_1_service_1_1_invoice_service.html">InvoiceService</a> $invoiceService, DocumentManager $documentManager, <a class="el" href="class_app_1_1_repository_1_1_contract_repository.html">ContractRepository</a> $contractRepository, <a class="el" href="class_app_1_1_repository_1_1_user_repository.html">UserRepository</a> $userRepository, LoggerInterface $logger, SessionInterface $session,)</td></tr>
<tr class="separator:a2130357ddfd30f07fae57426520c82cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8454ec0e8a0140888da98ba1228c4a77"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_contract_service.html#a8454ec0e8a0140888da98ba1228c4a77">registerContract</a> ()</td></tr>
<tr class="separator:a8454ec0e8a0140888da98ba1228c4a77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28f80ae843c1bbcac5d00679775cfdfe"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_contract_service.html#a28f80ae843c1bbcac5d00679775cfdfe">preContract</a> (Request $request)</td></tr>
<tr class="separator:a28f80ae843c1bbcac5d00679775cfdfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02f710cfb28b8372cb9be9249b7f8184"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_contract_service.html#a02f710cfb28b8372cb9be9249b7f8184">finishContract</a> (<a class="el" href="class_app_1_1_document_1_1_contracts_document.html">ContractsDocument</a> $contract)</td></tr>
<tr class="separator:a02f710cfb28b8372cb9be9249b7f8184"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57b1ccf4a3566606efad3c2fea847e1f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_app_1_1_service_1_1_contract_service.html#a57b1ccf4a3566606efad3c2fea847e1f">calculateTotal</a> (string $hourIn, string $hourOut, float $pricePerHour, float $taxes)</td></tr>
<tr class="separator:a57b1ccf4a3566606efad3c2fea847e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class ContractService</p>
<p>Service class to manage contract lifecycle. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2130357ddfd30f07fae57426520c82cc" name="a2130357ddfd30f07fae57426520c82cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2130357ddfd30f07fae57426520c82cc">&#9670;&#160;</a></span>__construct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__construct </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_app_1_1_service_1_1_invoice_service.html">InvoiceService</a>&#160;</td>
          <td class="paramname"><em>$invoiceService</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DocumentManager&#160;</td>
          <td class="paramname"><em>$documentManager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_app_1_1_repository_1_1_contract_repository.html">ContractRepository</a>&#160;</td>
          <td class="paramname"><em>$contractRepository</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="class_app_1_1_repository_1_1_user_repository.html">UserRepository</a>&#160;</td>
          <td class="paramname"><em>$userRepository</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LoggerInterface&#160;</td>
          <td class="paramname"><em>$logger</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SessionInterface&#160;</td>
          <td class="paramname"><em>$session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>ContractService constructor. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">InvoiceService</td><td class="paramname">$invoiceService</td><td></td></tr>
    <tr><td class="paramtype">DocumentManager</td><td class="paramname">$documentManager</td><td></td></tr>
    <tr><td class="paramtype">ContractRepository</td><td class="paramname">$contractRepository</td><td></td></tr>
    <tr><td class="paramtype">UserRepository</td><td class="paramname">$userRepository</td><td></td></tr>
    <tr><td class="paramtype">LoggerInterface</td><td class="paramname">$logger</td><td></td></tr>
    <tr><td class="paramtype">SessionInterface</td><td class="paramname">$session</td><td></td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">   67</span>      {</div>
<div class="line"><span class="lineno">   68</span>        $this-&gt;invoiceService = $invoiceService;</div>
<div class="line"><span class="lineno">   69</span>        $this-&gt;documentManager = $documentManager;</div>
<div class="line"><span class="lineno">   70</span>        $this-&gt;contractRepository = $contractRepository;</div>
<div class="line"><span class="lineno">   71</span>        $this-&gt;userRepository = $userRepository;</div>
<div class="line"><span class="lineno">   72</span>        $this-&gt;logger = $logger;</div>
<div class="line"><span class="lineno">   73</span>        $this-&gt;session = $session;</div>
<div class="line"><span class="lineno">   74</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a57b1ccf4a3566606efad3c2fea847e1f" name="a57b1ccf4a3566606efad3c2fea847e1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57b1ccf4a3566606efad3c2fea847e1f">&#9670;&#160;</a></span>calculateTotal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">calculateTotal </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$hourIn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>$hourOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>$pricePerHour</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>$taxes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the total payment based on the start time, end time, and price per hour.</p><ul>
<li>If the end time is less than or equal to the start time + 1 hour, the total payment is the price per hour.</li>
<li>For each additional hour, the total payment is increased by the price per hour.</li>
<li>At the end, taxes are applied to the total payment.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$hourIn</td><td>The start time of the contract in "HH:MM" format. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$hourOut</td><td>The end time of the contract in "HH:MM" format. </td></tr>
    <tr><td class="paramtype">float</td><td class="paramname">$pricePerHour</td><td>The price per hour. </td></tr>
    <tr><td class="paramtype">float</td><td class="paramname">$taxes</td><td>The tax rate to be applied to the total payment. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>float The total payment after considering the hours worked and applying taxes. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  292</span>                                                                                                      : <span class="keywordtype">float</span></div>
<div class="line"><span class="lineno">  293</span>    {</div>
<div class="line"><span class="lineno">  294</span>        $startTime = strtotime($hourIn);</div>
<div class="line"><span class="lineno">  295</span>        $endTime = strtotime($hourOut);</div>
<div class="line"><span class="lineno">  296</span> </div>
<div class="line"><span class="lineno">  297</span>        $hoursWorked = ceil(($endTime - $startTime) / 3600);</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>        <span class="keywordflow">if</span> ($hoursWorked &lt;= 1) {</div>
<div class="line"><span class="lineno">  300</span>            $total = $pricePerHour;</div>
<div class="line"><span class="lineno">  301</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  302</span>            $total = $hoursWorked * $pricePerHour;</div>
<div class="line"><span class="lineno">  303</span>        }</div>
<div class="line"><span class="lineno">  304</span> </div>
<div class="line"><span class="lineno">  305</span>        $totalWithTaxes = $total * (1 + $taxes);</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>        <span class="keywordflow">return</span> $totalWithTaxes;</div>
<div class="line"><span class="lineno">  308</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a02f710cfb28b8372cb9be9249b7f8184" name="a02f710cfb28b8372cb9be9249b7f8184"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02f710cfb28b8372cb9be9249b7f8184">&#9670;&#160;</a></span>finishContract()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">finishContract </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_app_1_1_document_1_1_contracts_document.html">ContractsDocument</a>&#160;</td>
          <td class="paramname"><em>$contract</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Finalizes a contract.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">ContractsDocument</td><td class="paramname">$contract</td><td>The contract to be finalized. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool|Response True if successful, or an HTTP response indicating an error. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  207</span>    {</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  209</span>            $hourOut = $this-&gt;getAdjustedDateTime()[<span class="stringliteral">&#39;time&#39;</span>];</div>
<div class="line"><span class="lineno">  210</span>    </div>
<div class="line"><span class="lineno">  211</span>            $totalPrice = $this-&gt;<a class="code hl_function" href="class_app_1_1_service_1_1_contract_service.html#a57b1ccf4a3566606efad3c2fea847e1f">calculateTotal</a>(</div>
<div class="line"><span class="lineno">  212</span>                $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#a0dfe58f1fdeed85ebd7f1c00ae6aa36e">getHourIn</a>(),</div>
<div class="line"><span class="lineno">  213</span>                $hourOut,</div>
<div class="line"><span class="lineno">  214</span>                $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#a55e0f0887984d70de3a4d9266f0a5969">getSpecialist</a>()-&gt;getPricePerHour(),</div>
<div class="line"><span class="lineno">  215</span>                $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#a31bf0a3a6ae58555ea9363dbebed135d">getTax</a>()</div>
<div class="line"><span class="lineno">  216</span>            );</div>
<div class="line"><span class="lineno">  217</span>    </div>
<div class="line"><span class="lineno">  218</span>            $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#ae8a30fc60c14d74af5a500a0a71c675a">setHourOut</a>($hourOut);</div>
<div class="line"><span class="lineno">  219</span>            $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#a70552878638d0e5c08f5d8b620c22ccb">setTotalPrice</a>($totalPrice);</div>
<div class="line"><span class="lineno">  220</span>            $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#a5db9fbe3083948770a3e7070d1ea3675">setStatus</a>(ContractsDocument::STATUS_COMPLETED);</div>
<div class="line"><span class="lineno">  221</span>            $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#acec67483401f3ca01413759a4d6547af">setPaid</a>(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  222</span>    </div>
<div class="line"><span class="lineno">  223</span>            $specialist = $contract-&gt;<a class="code hl_function" href="class_app_1_1_document_1_1_contracts_document.html#a55e0f0887984d70de3a4d9266f0a5969">getSpecialist</a>();</div>
<div class="line"><span class="lineno">  224</span>            $specialist-&gt;setIsAvailable(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">  225</span>            </div>
<div class="line"><span class="lineno">  226</span>            $this-&gt;documentManager-&gt;persist($contract);</div>
<div class="line"><span class="lineno">  227</span>            $this-&gt;documentManager-&gt;persist($specialist);</div>
<div class="line"><span class="lineno">  228</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>            </div>
<div class="line"><span class="lineno">  231</span>            <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  232</span>                $invoice = $this-&gt;invoiceService-&gt;generateInvoice($contract);</div>
<div class="line"><span class="lineno">  233</span>            } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  234</span>                $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Error in : &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  235</span>                <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Error trying to finish the contract.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  236</span>            }</div>
<div class="line"><span class="lineno">  237</span>    </div>
<div class="line"><span class="lineno">  238</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  239</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  240</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Finish contract failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  241</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Error trying to finish the contract.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  242</span>        }</div>
<div class="line"><span class="lineno">  243</span>    }  </div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_a0dfe58f1fdeed85ebd7f1c00ae6aa36e"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#a0dfe58f1fdeed85ebd7f1c00ae6aa36e">App\Document\ContractsDocument\getHourIn</a></div><div class="ttdeci">getHourIn()</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:171</div></div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_a31bf0a3a6ae58555ea9363dbebed135d"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#a31bf0a3a6ae58555ea9363dbebed135d">App\Document\ContractsDocument\getTax</a></div><div class="ttdeci">getTax()</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:240</div></div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_a55e0f0887984d70de3a4d9266f0a5969"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#a55e0f0887984d70de3a4d9266f0a5969">App\Document\ContractsDocument\getSpecialist</a></div><div class="ttdeci">getSpecialist()</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:125</div></div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_a5db9fbe3083948770a3e7070d1ea3675"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#a5db9fbe3083948770a3e7070d1ea3675">App\Document\ContractsDocument\setStatus</a></div><div class="ttdeci">setStatus(string $status)</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:297</div></div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_a70552878638d0e5c08f5d8b620c22ccb"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#a70552878638d0e5c08f5d8b620c22ccb">App\Document\ContractsDocument\setTotalPrice</a></div><div class="ttdeci">setTotalPrice(?float $totalPrice)</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:274</div></div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_acec67483401f3ca01413759a4d6547af"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#acec67483401f3ca01413759a4d6547af">App\Document\ContractsDocument\setPaid</a></div><div class="ttdeci">setPaid(bool $paid)</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:320</div></div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html_ae8a30fc60c14d74af5a500a0a71c675a"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html#ae8a30fc60c14d74af5a500a0a71c675a">App\Document\ContractsDocument\setHourOut</a></div><div class="ttdeci">setHourOut(?string $hourOut)</div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:205</div></div>
<div class="ttc" id="aclass_app_1_1_service_1_1_contract_service_html_a57b1ccf4a3566606efad3c2fea847e1f"><div class="ttname"><a href="class_app_1_1_service_1_1_contract_service.html#a57b1ccf4a3566606efad3c2fea847e1f">App\Service\ContractService\calculateTotal</a></div><div class="ttdeci">calculateTotal(string $hourIn, string $hourOut, float $pricePerHour, float $taxes)</div><div class="ttdef"><b>Definition:</b> ContractService.php:292</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a28f80ae843c1bbcac5d00679775cfdfe" name="a28f80ae843c1bbcac5d00679775cfdfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28f80ae843c1bbcac5d00679775cfdfe">&#9670;&#160;</a></span>preContract()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">preContract </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prepares a pre-contract based on a given request.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>The request containing the data needed to create the pre-contract. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array|Response An array containing the pre-contract data if successful, or an HTTP response indicating an error. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  131</span>    {</div>
<div class="line"><span class="lineno">  132</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">  133</span>            $clients = $this-&gt;userRepository-&gt;getUsersByRole(<span class="stringliteral">&#39;ROLE_CLIENT&#39;</span>);</div>
<div class="line"><span class="lineno">  134</span>            $specialists = $this-&gt;userRepository-&gt;getUsersByRole(<span class="stringliteral">&#39;ROLE_SPECIALIST&#39;</span>);</div>
<div class="line"><span class="lineno">  135</span>    </div>
<div class="line"><span class="lineno">  136</span>            $clientData = [];</div>
<div class="line"><span class="lineno">  137</span>            $clientId = (int) $request-&gt;get(<span class="stringliteral">&#39;clientId&#39;</span>);</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>            <span class="keywordflow">foreach</span> ($clients as $client) {</div>
<div class="line"><span class="lineno">  140</span>                <span class="keywordflow">if</span> ($client-&gt;getId() === $clientId) {</div>
<div class="line"><span class="lineno">  141</span>                    $clientData = [</div>
<div class="line"><span class="lineno">  142</span>                        <span class="stringliteral">&#39;id&#39;</span> =&gt; $client-&gt;getId(),</div>
<div class="line"><span class="lineno">  143</span>                        <span class="stringliteral">&#39;name&#39;</span> =&gt; $client-&gt;getName(),</div>
<div class="line"><span class="lineno">  144</span>                        <span class="stringliteral">&#39;surname&#39;</span> =&gt; $client-&gt;getSurname(),</div>
<div class="line"><span class="lineno">  145</span>                        <span class="stringliteral">&#39;address&#39;</span> =&gt; $client-&gt;getAddress(),</div>
<div class="line"><span class="lineno">  146</span>                        <span class="stringliteral">&#39;telephone&#39;</span> =&gt; $client-&gt;getTelephone()</div>
<div class="line"><span class="lineno">  147</span>                    ];</div>
<div class="line"><span class="lineno">  148</span>                    </div>
<div class="line"><span class="lineno">  149</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  150</span>                }</div>
<div class="line"><span class="lineno">  151</span>            }</div>
<div class="line"><span class="lineno">  152</span>    </div>
<div class="line"><span class="lineno">  153</span>            $specialistData = [];</div>
<div class="line"><span class="lineno">  154</span>            $specialistId = (int) $request-&gt;get(<span class="stringliteral">&#39;specialistId&#39;</span>);</div>
<div class="line"><span class="lineno">  155</span>            </div>
<div class="line"><span class="lineno">  156</span>            <span class="keywordflow">foreach</span> ($specialists as $specialist) {</div>
<div class="line"><span class="lineno">  157</span>                <span class="keywordflow">if</span> ($specialist-&gt;getId() === $specialistId) {</div>
<div class="line"><span class="lineno">  158</span>                    $pricePerHour = $specialist-&gt;getPricePerHour();</div>
<div class="line"><span class="lineno">  159</span>                    $priceWithTax = $pricePerHour + ($pricePerHour * 0.07);</div>
<div class="line"><span class="lineno">  160</span>                    </div>
<div class="line"><span class="lineno">  161</span>                    $category = $specialist-&gt;getCategory();</div>
<div class="line"><span class="lineno">  162</span>                    $categoryName = $category ? $category-&gt;getCategory() : <span class="keyword">null</span>;</div>
<div class="line"><span class="lineno">  163</span>                    </div>
<div class="line"><span class="lineno">  164</span>                    $specialistData = [</div>
<div class="line"><span class="lineno">  165</span>                        <span class="stringliteral">&#39;id&#39;</span> =&gt; $specialist-&gt;getId(),</div>
<div class="line"><span class="lineno">  166</span>                        <span class="stringliteral">&#39;name&#39;</span> =&gt; $specialist-&gt;getName(),</div>
<div class="line"><span class="lineno">  167</span>                        <span class="stringliteral">&#39;surname&#39;</span> =&gt; $specialist-&gt;getSurname(),</div>
<div class="line"><span class="lineno">  168</span>                        <span class="stringliteral">&#39;pricePerHour&#39;</span> =&gt; $specialist-&gt;getPricePerHour(),</div>
<div class="line"><span class="lineno">  169</span>                        <span class="stringliteral">&#39;category&#39;</span> =&gt; $categoryName,</div>
<div class="line"><span class="lineno">  170</span>                        <span class="stringliteral">&#39;telephone&#39;</span> =&gt; $specialist-&gt;getTelephone(),</div>
<div class="line"><span class="lineno">  171</span>                        <span class="stringliteral">&#39;total&#39;</span> =&gt; $priceWithTax,</div>
<div class="line"><span class="lineno">  172</span>                    ];</div>
<div class="line"><span class="lineno">  173</span>                    </div>
<div class="line"><span class="lineno">  174</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  175</span>                }</div>
<div class="line"><span class="lineno">  176</span>            }</div>
<div class="line"><span class="lineno">  177</span>    </div>
<div class="line"><span class="lineno">  178</span>            $adjustedDateTime = $this-&gt;getAdjustedDateTime();</div>
<div class="line"><span class="lineno">  179</span>    </div>
<div class="line"><span class="lineno">  180</span>            $this-&gt;session-&gt;set(<span class="stringliteral">&#39;preContract&#39;</span>, [</div>
<div class="line"><span class="lineno">  181</span>                <span class="stringliteral">&#39;clients&#39;</span> =&gt; $clientData,</div>
<div class="line"><span class="lineno">  182</span>                <span class="stringliteral">&#39;specialists&#39;</span> =&gt; $specialistData,</div>
<div class="line"><span class="lineno">  183</span>                <span class="stringliteral">&#39;date&#39;</span> =&gt; $adjustedDateTime[<span class="stringliteral">&#39;date&#39;</span>],</div>
<div class="line"><span class="lineno">  184</span>                <span class="stringliteral">&#39;hour&#39;</span> =&gt; $adjustedDateTime[<span class="stringliteral">&#39;time&#39;</span>],</div>
<div class="line"><span class="lineno">  185</span>            ]);</div>
<div class="line"><span class="lineno">  186</span>    </div>
<div class="line"><span class="lineno">  187</span>            <span class="keywordflow">return</span> [</div>
<div class="line"><span class="lineno">  188</span>                <span class="stringliteral">&#39;clients&#39;</span> =&gt; $clientData,</div>
<div class="line"><span class="lineno">  189</span>                <span class="stringliteral">&#39;specialists&#39;</span> =&gt; $specialistData,</div>
<div class="line"><span class="lineno">  190</span>                <span class="stringliteral">&#39;date&#39;</span> =&gt; $adjustedDateTime[<span class="stringliteral">&#39;date&#39;</span>],</div>
<div class="line"><span class="lineno">  191</span>                <span class="stringliteral">&#39;hour&#39;</span> =&gt; $adjustedDateTime[<span class="stringliteral">&#39;time&#39;</span>],</div>
<div class="line"><span class="lineno">  192</span>            ];</div>
<div class="line"><span class="lineno">  193</span>    </div>
<div class="line"><span class="lineno">  194</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  195</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Error in getting the data: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  196</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Error in getting the data.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  197</span>        }</div>
<div class="line"><span class="lineno">  198</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8454ec0e8a0140888da98ba1228c4a77" name="a8454ec0e8a0140888da98ba1228c4a77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8454ec0e8a0140888da98ba1228c4a77">&#9670;&#160;</a></span>registerContract()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">registerContract </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Registers a contract in the system</p>
<dl class="section return"><dt>Returns</dt><dd>bool|Response True if successful, or an HTTP response indicating an error. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   82</span>    {</div>
<div class="line"><span class="lineno">   83</span>        <span class="keywordflow">try</span> {</div>
<div class="line"><span class="lineno">   84</span>            $preContract = $this-&gt;session-&gt;get(<span class="stringliteral">&#39;preContract&#39;</span>);</div>
<div class="line"><span class="lineno">   85</span>    </div>
<div class="line"><span class="lineno">   86</span>            $contract = <span class="keyword">new</span> <a class="code hl_class" href="class_app_1_1_document_1_1_contracts_document.html">ContractsDocument</a>();</div>
<div class="line"><span class="lineno">   87</span>    </div>
<div class="line"><span class="lineno">   88</span>            $clientId = (int) $preContract[<span class="stringliteral">&#39;clients&#39;</span>][<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><span class="lineno">   89</span>            $specialistId = (int) $preContract[<span class="stringliteral">&#39;specialists&#39;</span>][<span class="stringliteral">&#39;id&#39;</span>];</div>
<div class="line"><span class="lineno">   90</span>            $client = $this-&gt;documentManager-&gt;getRepository(UsersDocument::class)-&gt;find($clientId);</div>
<div class="line"><span class="lineno">   91</span>            $specialist = $this-&gt;documentManager-&gt;getRepository(UsersDocument::class)-&gt;find($specialistId);</div>
<div class="line"><span class="lineno">   92</span>    </div>
<div class="line"><span class="lineno">   93</span>            $contract-&gt;setClient($client);</div>
<div class="line"><span class="lineno">   94</span>            $contract-&gt;setSpecialist($specialist);</div>
<div class="line"><span class="lineno">   95</span>    </div>
<div class="line"><span class="lineno">   96</span>            $specialist-&gt;setIsAvailable(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">   97</span>            $this-&gt;documentManager-&gt;persist($specialist);</div>
<div class="line"><span class="lineno">   98</span>    </div>
<div class="line"><span class="lineno">   99</span>            $date = new \DateTime($preContract[<span class="stringliteral">&#39;date&#39;</span>]);</div>
<div class="line"><span class="lineno">  100</span>            $contract-&gt;setDate($date);</div>
<div class="line"><span class="lineno">  101</span>    </div>
<div class="line"><span class="lineno">  102</span>            $hourIn = $preContract[<span class="stringliteral">&#39;hour&#39;</span>];</div>
<div class="line"><span class="lineno">  103</span>            $contract-&gt;setHourIn($hourIn);</div>
<div class="line"><span class="lineno">  104</span>    </div>
<div class="line"><span class="lineno">  105</span>            $contract-&gt;setPricePerHour($preContract[<span class="stringliteral">&#39;specialists&#39;</span>][<span class="stringliteral">&#39;pricePerHour&#39;</span>]);</div>
<div class="line"><span class="lineno">  106</span>            $contract-&gt;setStatus(ContractsDocument::STATUS_IN_PROGRESS);</div>
<div class="line"><span class="lineno">  107</span>            $contract-&gt;setPaid(<span class="keyword">false</span>);</div>
<div class="line"><span class="lineno">  108</span>    </div>
<div class="line"><span class="lineno">  109</span>            $totalPrice = $preContract[<span class="stringliteral">&#39;specialists&#39;</span>][<span class="stringliteral">&#39;pricePerHour&#39;</span>] + ($preContract[<span class="stringliteral">&#39;specialists&#39;</span>][<span class="stringliteral">&#39;pricePerHour&#39;</span>] * $contract-&gt;getTax());</div>
<div class="line"><span class="lineno">  110</span>            $contract-&gt;setTotalPrice($totalPrice);</div>
<div class="line"><span class="lineno">  111</span>    </div>
<div class="line"><span class="lineno">  112</span>            $this-&gt;documentManager-&gt;persist($contract);</div>
<div class="line"><span class="lineno">  113</span>            $this-&gt;documentManager-&gt;flush();</div>
<div class="line"><span class="lineno">  114</span>    </div>
<div class="line"><span class="lineno">  115</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  116</span>    </div>
<div class="line"><span class="lineno">  117</span>        } <span class="keywordflow">catch</span> (Exception $e) {</div>
<div class="line"><span class="lineno">  118</span>            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Contract register failed: &#39;</span> . $e-&gt;getMessage());</div>
<div class="line"><span class="lineno">  119</span>            <span class="keywordflow">return</span> <span class="keyword">new</span> Response(<span class="stringliteral">&#39;Contract register failed.&#39;</span>, Response::HTTP_INTERNAL_SERVER_ERROR);</div>
<div class="line"><span class="lineno">  120</span>        }</div>
<div class="line"><span class="lineno">  121</span>    }</div>
<div class="ttc" id="aclass_app_1_1_document_1_1_contracts_document_html"><div class="ttname"><a href="class_app_1_1_document_1_1_contracts_document.html">App\Document\ContractsDocument</a></div><div class="ttdef"><b>Definition:</b> ContractsDocument.php:16</div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/xampp/htdocs/HandyHub/src/Service/ContractService.php</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
